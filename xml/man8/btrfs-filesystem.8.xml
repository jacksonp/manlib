<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?asciidoc-toc?>
<?asciidoc-numbered?>
<refentry>
<refmeta>
<refentrytitle>btrfs-filesystem</refentrytitle>
<manvolnum>8</manvolnum>
<refmiscinfo class="source">Btrfs</refmiscinfo>
<refmiscinfo class="version">v4.3.1</refmiscinfo>
<refmiscinfo class="manual">Btrfs Manual</refmiscinfo>
</refmeta>
<refnamediv>
  <refname>btrfs-filesystem</refname>
  <refpurpose>control btrfs filesystem</refpurpose>
</refnamediv>
<refsynopsisdiv id="_synopsis">
<simpara><emphasis role="strong">btrfs filesystem</emphasis> <emphasis>&lt;subcommand&gt;</emphasis> <emphasis>&lt;args&gt;</emphasis></simpara>
</refsynopsisdiv>
<refsect1 id="_description">
<title>DESCRIPTION</title>
<simpara><emphasis role="strong">btrfs filesystem</emphasis> is used to do the filesystem level control jobs, including
all the regular filesystem operations like setting/getting label,
resizing, defragment.</simpara>
</refsect1>
<refsect1 id="_subcommand">
<title>SUBCOMMAND</title>
<variablelist>
<varlistentry>
<term>
<emphasis role="strong">df</emphasis> [options] <emphasis>&lt;path&gt;</emphasis>
</term>
<listitem>
<simpara>
Show space usage information for a mount point.
</simpara>
<simpara><literal>Options</literal></simpara>
<variablelist>
<varlistentry>
<term>
-b|--raw
</term>
<listitem>
<simpara>
raw numbers in bytes, without the <emphasis>B</emphasis> suffix
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-h|--human-readable
</term>
<listitem>
<simpara>
print human friendly numbers, base 1024, this is the default
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-H
</term>
<listitem>
<simpara>
print human friendly numbers, base 1000
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--iec
</term>
<listitem>
<simpara>
select the 1024 base for the following options, according to the IEC standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--si
</term>
<listitem>
<simpara>
select the 1000 base for the following options, according to the SI standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-k|--kbytes
</term>
<listitem>
<simpara>
show sizes in KiB, or kB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-m|--mbytes
</term>
<listitem>
<simpara>
show sizes in MiB, or MB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-g|--gbytes
</term>
<listitem>
<simpara>
show sizes in GiB, or GB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-t|--tbytes
</term>
<listitem>
<simpara>
show sizes in TiB, or TB with --si
</simpara>
<simpara>If conflicting options are passed, the last one takes precedence.</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis role="strong">defragment</emphasis> [options] <emphasis>&lt;file&gt;</emphasis>|<emphasis>&lt;dir&gt;</emphasis> [<emphasis>&lt;file&gt;</emphasis>|<emphasis>&lt;dir&gt;</emphasis>&#8230;]
</term>
<listitem>
<simpara>
Defragment file data and/or directory metadata <emphasis role="strong">online</emphasis>.
</simpara>
<simpara>If <emphasis>-r</emphasis> is passed, files in dir will be defragmented recursively.
The start position and the number of bytes to defragment can be specified by
start and len using <emphasis>-s</emphasis> and <emphasis>-l</emphasis> options below.
Extents bigger than value given by <emphasis>-t</emphasis> will be skipped, otherwise this value
is used as a target extent size, but is only advisory and may not be reached
if the free space is too fragmented.
Use 0 to take the kernel default, which is 256kB but may change in the future.
You can also turn on compression in defragment operations.</simpara>
<simpara><literal>Options</literal></simpara>
<variablelist>
<varlistentry>
<term>
-v
</term>
<listitem>
<simpara>
be verbose
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-c[<emphasis>&lt;algo&gt;</emphasis>]
</term>
<listitem>
<simpara>
compress file contents while defragmenting. Optional argument selects the compression
algorithm, <emphasis>zlib</emphasis> (default) or <emphasis>lzo</emphasis>. Currently it&#8217;s not possible to select no
compression.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-r
</term>
<listitem>
<simpara>
defragment files recursively in given directories
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-f
</term>
<listitem>
<simpara>
flush data for each file before going to the next file. This will limit the amount
of dirty data to current file, otherwise the amount cumulates from several files
and may increase system load.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-s <emphasis>&lt;start&gt;</emphasis>[kKmMgGtTpPeE]
</term>
<listitem>
<simpara>
defragment only from byte <emphasis>&lt;start&gt;</emphasis> onward
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-l <emphasis>&lt;len&gt;</emphasis>[kKmMgGtTpPeE]
</term>
<listitem>
<simpara>
defragment only up to <emphasis>&lt;len&gt;</emphasis> bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-t <emphasis>&lt;size&gt;</emphasis>[kKmMgGtTpPeE]
</term>
<listitem>
<simpara>
target extent size, do not touch extents bigger than <emphasis>&lt;size&gt;</emphasis>
</simpara>
<simpara>For <emphasis>&lt;start&gt;</emphasis>, <emphasis>&lt;len&gt;</emphasis>, <emphasis>&lt;size&gt;</emphasis> it is possible to append
units designator: 'K', 'M', 'G', 'T', 'P', or 'E', which represent
KiB, MiB, GiB, TiB, PiB, or EiB, respectively. Case does not matter.</simpara>
<warning><simpara>defragmenting with kernels up to 2.6.37 will unlink COW-ed copies of data,
don&#8217;t use it if you use snapshots, have de-duplicated your data or made
copies with <literal>cp --reflink</literal>.</simpara></warning>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis role="strong">label</emphasis> [<emphasis>&lt;dev&gt;</emphasis>|<emphasis>&lt;mountpoint&gt;</emphasis>] [<emphasis>&lt;newlabel&gt;</emphasis>]
</term>
<listitem>
<simpara>
Show or update the label of a filesystem.
</simpara>
<simpara>[<emphasis>&lt;device&gt;</emphasis>|<emphasis>&lt;mountpoint&gt;</emphasis>] is used to identify the filesystem.
If a newlabel optional argument is passed, the label is changed.</simpara>
<note><simpara>the maximum allowable length shall be less than 256 chars</simpara></note>
</listitem>
</varlistentry>
</variablelist>
<variablelist>
<varlistentry>
<term>
<emphasis role="strong">resize</emphasis> [<emphasis>&lt;devid&gt;</emphasis>:][+/-]<emphasis>&lt;size&gt;</emphasis>[kKmMgGtTpPeE]|[<emphasis>&lt;devid&gt;</emphasis>:]max <emphasis>&lt;path&gt;</emphasis>
</term>
<listitem>
<simpara>
Resize a mounted filesystem identified by directory <emphasis>&lt;path&gt;</emphasis>. A particular device
can be resized by specifying a <emphasis>&lt;devid&gt;</emphasis>.
</simpara>
<simpara>If <emphasis>&lt;path&gt;</emphasis> is a file containing a btrfs image then resize does not work as
expected and does not resize the image. This would resize the underlying
filesystem instead.</simpara>
<simpara>The devid can be found with <emphasis role="strong">btrfs filesystem show</emphasis> and
defaults to 1 if not specified.
The <emphasis>&lt;size&gt;</emphasis> parameter specifies the new size of the filesystem.
If the prefix + or - is present the size is increased or decreased
by the quantity <emphasis>&lt;size&gt;</emphasis>.
If no units are specified, the unit of the <emphasis>&lt;size&gt;</emphasis> parameter defaults to
bytes. Optionally, the size parameter may be suffixed by one of the following
units designators: 'K', 'M', 'G', 'T', 'P', or 'E', which represent
KiB, MiB, GiB, TiB, PiB, or EiB, respectively. Case does not matter.</simpara>
<simpara>If 'max' is passed, the filesystem will occupy all available space on the
device devid.</simpara>
<simpara>The resize command does not manipulate the size of underlying
partition.  If you wish to enlarge/reduce a filesystem, you must make sure you
can expand the partition before enlarging the filesystem and shrink the
partition after reducing the size of the filesystem.  This can done using
<literal>fdisk</literal>(8) or <literal>parted</literal>(8) to delete the existing partition and recreate
it with the new desired size.  When recreating the partition make sure to use
the same starting disk cylinder as before.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis role="strong">show</emphasis> [options] [<emphasis>&lt;path&gt;</emphasis>|<emphasis>&lt;uuid&gt;</emphasis>|<emphasis>&lt;device&gt;</emphasis>|<emphasis>&lt;label&gt;</emphasis>]
</term>
<listitem>
<simpara>
Show the btrfs filesystem with some additional info.
</simpara>
<simpara>If no option nor <emphasis>&lt;path&gt;</emphasis>|<emphasis>&lt;uuid&gt;</emphasis>|<emphasis>&lt;device&gt;</emphasis>|<emphasis>&lt;label&gt;</emphasis> is passed, btrfs shows
information of all the btrfs filesystem both mounted and unmounted.</simpara>
<simpara><literal>Options</literal></simpara>
<variablelist>
<varlistentry>
<term>
-m|--mounted
</term>
<listitem>
<simpara>
probe btrfs kernel to list mounted btrfs filesystems(s)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-d|--all-devices
</term>
<listitem>
<simpara>
scan all devices under /dev, otherwise the devices list is extracted from the
/proc/partitions file.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--raw
</term>
<listitem>
<simpara>
raw numbers in bytes, without the <emphasis>B</emphasis> suffix
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--human-readable
</term>
<listitem>
<simpara>
print human friendly numbers, base 1024, this is the default
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--iec
</term>
<listitem>
<simpara>
select the 1024 base for the following options, according to the IEC standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--si
</term>
<listitem>
<simpara>
select the 1000 base for the following options, according to the SI standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--kbytes
</term>
<listitem>
<simpara>
show sizes in KiB, or kB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--mbytes
</term>
<listitem>
<simpara>
show sizes in MiB, or MB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--gbytes
</term>
<listitem>
<simpara>
show sizes in GiB, or GB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--tbytes
</term>
<listitem>
<simpara>
show sizes in TiB, or TB with --si
</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis role="strong">sync</emphasis> <emphasis>&lt;path&gt;</emphasis>
</term>
<listitem>
<simpara>
Force a sync for the filesystem identified by <emphasis>&lt;path&gt;</emphasis>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis role="strong">usage</emphasis> [options] <emphasis>&lt;path&gt;</emphasis> [<emphasis>&lt;path&gt;</emphasis>&#8230;]
</term>
<listitem>
<simpara>
Show detailed information about internal filesystem usage.
</simpara>
<simpara><literal>Options</literal></simpara>
<variablelist>
<varlistentry>
<term>
-b|--raw
</term>
<listitem>
<simpara>
raw numbers in bytes, without the <emphasis>B</emphasis> suffix
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-h|--human-readable
</term>
<listitem>
<simpara>
print human friendly numbers, base 1024, this is the default
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-H
</term>
<listitem>
<simpara>
print human friendly numbers, base 1000
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--iec
</term>
<listitem>
<simpara>
select the 1024 base for the following options, according to the IEC standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
--si
</term>
<listitem>
<simpara>
select the 1000 base for the following options, according to the SI standard
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-k|--kbytes
</term>
<listitem>
<simpara>
show sizes in KiB, or kB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-m|--mbytes
</term>
<listitem>
<simpara>
show sizes in MiB, or MB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-g|--gbytes
</term>
<listitem>
<simpara>
show sizes in GiB, or GB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-t|--tbytes
</term>
<listitem>
<simpara>
show sizes in TiB, or TB with --si
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
-T
</term>
<listitem>
<simpara>
show data in tabular format
</simpara>
<simpara>If conflicting options are passed, the last one takes precedence.</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
</variablelist>
</refsect1>
<refsect1 id="_exit_status">
<title>EXIT STATUS</title>
<simpara><emphasis role="strong">btrfs filesystem</emphasis> returns a zero exit status if it succeeds. Non zero is
returned in case of failure.</simpara>
</refsect1>
<refsect1 id="_availability">
<title>AVAILABILITY</title>
<simpara><emphasis role="strong">btrfs</emphasis> is part of btrfs-progs.
Please refer to the btrfs wiki <ulink url="http://btrfs.wiki.kernel.org">http://btrfs.wiki.kernel.org</ulink> for
further details.</simpara>
</refsect1>
<refsect1 id="_see_also">
<title>SEE ALSO</title>
<simpara><literal>mkfs.btrfs</literal>(8),</simpara>
</refsect1>
</refentry>
