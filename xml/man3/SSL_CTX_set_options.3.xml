<!-- Converted by db4-upgrade version 1.1 -->
<refentry xmlns="http://docbook.org/ns/docbook" version="5.0">
  <refmeta>
    <refentrytitle>SSL_CTX_set_options.pod</refentrytitle>
  </refmeta>
  <refnamediv>
    <refname>SSL_CTX_set_options, SSL_set_options, SSL_CTX_clear_options, SSL_clear_options, SSL_CTX_get_options, SSL_get_options, SSL_get_secure_renegotiation_support</refname>
<refpurpose>manipulate SSL options</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
<synopsis format="linespecific">#include &lt;openssl/ssl.h&gt;</synopsis>
<synopsis format="linespecific">long SSL_CTX_set_options(SSL_CTX *ctx, long options);
long SSL_set_options(SSL *ssl, long options);</synopsis>
<synopsis format="linespecific">long SSL_CTX_clear_options(SSL_CTX *ctx, long options);
long SSL_clear_options(SSL *ssl, long options);</synopsis>
<synopsis format="linespecific">long SSL_CTX_get_options(SSL_CTX *ctx);
long SSL_get_options(SSL *ssl);</synopsis>
<synopsis format="linespecific">long SSL_get_secure_renegotiation_support(SSL *ssl);</synopsis>
  </refsynopsisdiv>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:DESCRIPTION"><title>DESCRIPTION</title>
    <para>
      Note: all these functions are implemented using macros.
    </para>
    <para>
      SSL_CTX_set_options() adds the options set via bitmask in <emphasis role="bold">options</emphasis> to <emphasis role="bold">ctx</emphasis>. Options already set before are not
      cleared!
    </para>
    <para>
      SSL_set_options() adds the options set via bitmask in <emphasis role="bold">options</emphasis> to <emphasis role="bold">ssl</emphasis>. Options already set before are not
      cleared!
    </para>
    <para>
      SSL_CTX_clear_options() clears the options set via bitmask in
      <emphasis role="bold">options</emphasis> to <emphasis role="bold">ctx</emphasis>.
    </para>
    <para>
      SSL_clear_options() clears the options set via bitmask in <emphasis role="bold">options</emphasis> to <emphasis role="bold">ssl</emphasis>.
    </para>
    <para>
      SSL_CTX_get_options() returns the options set for <emphasis role="bold">ctx</emphasis>.
    </para>
    <para>
      SSL_get_options() returns the options set for <emphasis role="bold">ssl</emphasis>.
    </para>
    <para>
      SSL_get_secure_renegotiation_support() indicates whether the peer
      supports secure renegotiation.
    </para>
  </refsection>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:NOTES"><title>NOTES</title>
    <para>
      The behaviour of the SSL library can be changed by setting several
      options. The options are coded as bitmasks and can be combined by a
      bitwise <emphasis role="bold">or</emphasis> operation (|).
    </para>
    <para>
      SSL_CTX_set_options() and SSL_set_options() affect the (external)
      protocol behaviour of the SSL library. The (internal) behaviour of
      the API can be changed by using the similar SSL_CTX_set_mode(3) and
      SSL_set_mode() functions.
    </para>
    <para>
      During a handshake, the option settings of the SSL object are used.
      When a new SSL object is created from a context using SSL_new(), the
      current option setting is copied. Changes to <emphasis role="bold">ctx</emphasis> do not affect already created SSL objects.
      SSL_clear() does not affect the settings.
    </para>
    <para>
      The following <emphasis role="bold">bug workaround</emphasis> options
      are available:
    </para>
    <para>
      <variablelist>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_MICROSOFT_SESS_ID_BUG"/>SSL_OP_MICROSOFT_SESS_ID_BUG</term>
          <listitem>
            <para>
	      As of OpenSSL 1.0.0 this option has no effect.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NETSCAPE_CHALLENGE_BUG"/>SSL_OP_NETSCAPE_CHALLENGE_BUG</term>
          <listitem>
            <para>
	      As of OpenSSL 1.0.0 this option has no effect.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG"/>SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG</term>
          <listitem>
            <para>
	      As of OpenSSL 0.9.8q and 1.0.0c, this option has no effect.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG"/>SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER"/>SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_SAFARI_ECDHE_ECDSA_BUG"/>SSL_OP_SAFARI_ECDHE_ECDSA_BUG</term>
          <listitem>
            <para>
	      Don't prefer ECDHE-ECDSA ciphers when the client appears to
	      be Safari on OS X. OS X 10.8..10.8.3 has broken support for
	      ECDHE-ECDSA ciphers.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_SSLEAY_080_CLIENT_DH_BUG"/>SSL_OP_SSLEAY_080_CLIENT_DH_BUG</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_TLS_D5_BUG"/>SSL_OP_TLS_D5_BUG</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_TLS_BLOCK_PADDING_BUG"/>SSL_OP_TLS_BLOCK_PADDING_BUG</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS"/>SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</term>
          <listitem>
            <para>
	      Disables a countermeasure against a SSL 3.0/TLS 1.0 protocol
	      vulnerability affecting CBC ciphers, which cannot be handled
	      by some broken SSL implementations.  This option has no
	      effect for connections using other ciphers.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_TLSEXT_PADDING"/>SSL_OP_TLSEXT_PADDING</term>
          <listitem>
            <para>
	      Adds a padding extension to ensure the ClientHello size is
	      never between 256 and 511 bytes in length. This is needed as
	      a workaround for some implementations.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_ALL"/>SSL_OP_ALL</term>
          <listitem>
            <para>
	      All of the above bug workarounds.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>
    <para>
      It is usually safe to use <emphasis role="bold">SSL_OP_ALL</emphasis>
      to enable the bug workaround options if compatibility with somewhat
      broken implementations is desired.
    </para>
    <para>
      The following <emphasis role="bold">modifying</emphasis> options are
      available:
    </para>
    <para>
      <variablelist>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_TLS_ROLLBACK_BUG"/>SSL_OP_TLS_ROLLBACK_BUG</term>
          <listitem>
            <para>
	      Disable version rollback attack detection.
            </para>
            <para>
	      During the client key exchange, the client must send the same
	      information about acceptable SSL/TLS protocol levels as
	      during the first hello. Some clients violate this rule by
	      adapting to the server's answer. (Example: the client sends a
	      SSLv2 hello and accepts up to SSLv3.1=TLSv1, the server only
	      understands up to SSLv3. In this case the client must still
	      use the same SSLv3.1=TLSv1 announcement. Some clients step
	      down to SSLv3 with respect to the server's answer and violate
	      the version rollback protection.)
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_SINGLE_DH_USE"/>SSL_OP_SINGLE_DH_USE</term>
          <listitem>
            <para>
	      Always create a new key when using temporary/ephemeral DH
	      parameters (see SSL_CTX_set_tmp_dh_callback(3)). This option
	      must be used to prevent small subgroup attacks, when the DH
	      parameters were not generated using "strong" primes (e.g.
	      when using DSA-parameters, see dhparam(1)). If "strong"
	      primes were used, it is not strictly necessary to generate a
	      new DH key during each handshake but it is also recommended.
	      <emphasis role="bold">SSL_OP_SINGLE_DH_USE</emphasis> should
	      therefore be enabled whenever temporary/ephemeral DH
	      parameters are used.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_EPHEMERAL_RSA"/>SSL_OP_EPHEMERAL_RSA</term>
          <listitem>
            <para>
	      This option is no longer implemented and is treated as no op.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_CIPHER_SERVER_PREFERENCE"/>SSL_OP_CIPHER_SERVER_PREFERENCE</term>
          <listitem>
            <para>
	      When choosing a cipher, use the server's preferences instead
	      of the client preferences. When not set, the SSL server will
	      always follow the clients preferences. When set, the
	      SSLv3/TLSv1 server will choose following its own preferences.
	      Because of the different protocol, for SSLv2 the server will
	      send its list of preferences to the client and the client
	      chooses.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_PKCS1_CHECK_1"/>SSL_OP_PKCS1_CHECK_1</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_PKCS1_CHECK_2"/>SSL_OP_PKCS1_CHECK_2</term>
          <listitem>
            <para>
	      ...
            </para>
            <screen></screen>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG"/>SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG</term>
          <listitem>
            <para>
	      ...
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NO_SSLv2"/>SSL_OP_NO_SSLv2</term>
          <listitem>
            <para>
	      Do not use the SSLv2 protocol.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NO_SSLv3"/>SSL_OP_NO_SSLv3</term>
          <listitem>
            <para>
	      Do not use the SSLv3 protocol.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NO_TLSv1"/>SSL_OP_NO_TLSv1</term>
          <listitem>
            <para>
	      Do not use the TLSv1 protocol.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION"/>SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</term>
          <listitem>
            <para>
	      When performing renegotiation as a server, always start a new
	      session (i.e., session resumption requests are only accepted
	      in the initial handshake). This option is not needed for
	      clients.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_NO_TICKET"/>SSL_OP_NO_TICKET</term>
          <listitem>
            <para>
	      Normally clients and servers will, where possible,
	      transparently make use of RFC4507bis tickets for stateless
	      session resumption.
            </para>
            <para>
	      If this option is set this functionality is disabled and
	      tickets will not be used by clients or servers.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION"/>SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</term>
          <listitem>
            <para>
	      Allow legacy insecure renegotiation between OpenSSL and
	      unpatched clients or servers. See the <emphasis role="bold">SECURE RENEGOTIATION</emphasis> section for more
	      details.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><anchor xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SSL_OP_LEGACY_SERVER_CONNECT"/>SSL_OP_LEGACY_SERVER_CONNECT</term>
          <listitem>
            <para>
	      Allow legacy insecure renegotiation between OpenSSL and
	      unpatched servers <emphasis role="bold">only</emphasis>: this
	      option is currently set by default. See the <emphasis role="bold">SECURE RENEGOTIATION</emphasis> section for more
	      details.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>
  </refsection>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SECURE_RENEGOTIATION"><title>SECURE RENEGOTIATION</title>
    <para>
      OpenSSL 0.9.8m and later always attempts to use secure renegotiation
      as described in RFC5746. This counters the prefix attack described in
      CVE-2009-3555 and elsewhere.
    </para>
    <para>
      The deprecated and highly broken SSLv2 protocol does not support
      renegotiation at all: its use is <emphasis role="bold">strongly</emphasis> discouraged.
    </para>
    <para>
      This attack has far reaching consequences which application writers
      should be aware of. In the description below an implementation
      supporting secure renegotiation is referred to as <emphasis role="italic">patched</emphasis>. A server not supporting secure
      renegotiation is referred to as <emphasis role="italic">unpatched</emphasis>.
    </para>
    <para>
      The following sections describe the operations permitted by OpenSSL's
      secure renegotiation implementation.
    </para>
    <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:Patched_client_and_server"><title>Patched client and server</title>
      <para>
	Connections and renegotiation are always permitted by OpenSSL
	implementations.
      </para>
    </refsection>
    <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:Unpatched_client_and_patched_OpenSSL_server"><title>Unpatched client and patched OpenSSL server</title>
      <para>
	The initial connection succeeds but client renegotiation is denied
	by the server with a <emphasis role="bold">no_renegotiation</emphasis> warning alert if TLS v1.0
	is used or a fatal <emphasis role="bold">handshake_failure</emphasis> alert in SSL v3.0.
      </para>
      <para>
	If the patched OpenSSL server attempts to renegotiate a fatal
	<emphasis role="bold">handshake_failure</emphasis> alert is sent.
	This is because the server code may be unaware of the unpatched
	nature of the client.
      </para>
      <para>
	If the option <emphasis role="bold">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</emphasis> is
	set then renegotiation <emphasis role="bold">always</emphasis>
	succeeds.
      </para>
      <para>
	<emphasis role="bold">NB:</emphasis> a bug in OpenSSL clients
	earlier than 0.9.8m (all of which are unpatched) will result in the
	connection hanging if it receives a <emphasis role="bold">no_renegotiation</emphasis> alert. OpenSSL versions
	0.9.8m and later will regard a <emphasis role="bold">no_renegotiation</emphasis> alert as fatal and respond
	with a fatal <emphasis role="bold">handshake_failure</emphasis>
	alert. This is because the OpenSSL API currently has no provision
	to indicate to an application that a renegotiation attempt was
	refused.
      </para>
    </refsection>
    <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:Patched_OpenSSL_client_and_unpatched_server."><title>Patched OpenSSL client and unpatched server.</title>
      <para>
	If the option <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> or <emphasis role="bold">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</emphasis> is
	set then initial connections and renegotiation between patched
	OpenSSL clients and unpatched servers succeeds. If neither option
	is set then initial connections to unpatched servers will fail.
      </para>
      <para>
	The option <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> is currently
	set by default even though it has security implications: otherwise
	it would be impossible to connect to unpatched servers (i.e. all of
	them initially) and this is clearly not acceptable. Renegotiation
	is permitted because this does not add any additional security
	issues: during an attack clients do not see any renegotiations
	anyway.
      </para>
      <para>
	As more servers become patched the option <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> will <emphasis role="bold">not</emphasis> be set by default in a future version of
	OpenSSL.
      </para>
      <para>
	OpenSSL client applications wishing to ensure they can connect to
	unpatched servers should always <emphasis role="bold">set</emphasis> <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis>
      </para>
      <para>
	OpenSSL client applications that want to ensure they can <emphasis role="bold">not</emphasis> connect to unpatched servers (and thus
	avoid any security issues) should always <emphasis role="bold">clear</emphasis> <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> using
	SSL_CTX_clear_options() or SSL_clear_options().
      </para>
      <para>
	The difference between the <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> and <emphasis role="bold">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</emphasis>
	options is that <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> enables initial
	connections and secure renegotiation between OpenSSL clients and
	unpatched servers <emphasis role="bold">only</emphasis>, while
	<emphasis role="bold">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</emphasis>
	allows initial connections and renegotiation between OpenSSL and
	unpatched clients or servers.
      </para>
    </refsection>
  </refsection>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:RETURN_VALUES"><title>RETURN VALUES</title>
    <para>
      SSL_CTX_set_options() and SSL_set_options() return the new options
      bitmask after adding <emphasis role="bold">options</emphasis>.
    </para>
    <para>
      SSL_CTX_clear_options() and SSL_clear_options() return the new
      options bitmask after clearing <emphasis role="bold">options</emphasis>.
    </para>
    <para>
      SSL_CTX_get_options() and SSL_get_options() return the current
      bitmask.
    </para>
    <para>
      SSL_get_secure_renegotiation_support() returns 1 is the peer supports
      secure renegotiation and 0 if it does not.
    </para>
  </refsection>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:SEE_ALSO"><title>SEE ALSO</title>
    <para>
      ssl(3), SSL_new(3), SSL_clear(3), SSL_CTX_set_tmp_dh_callback(3),
      SSL_CTX_set_tmp_rsa_callback(3), dhparam(1)
    </para>
  </refsection>
  <refsection xml:id="sources.openssl.doc.ssl.SSL_CTX_set_options.pod:HISTORY"><title>HISTORY</title>
    <para>
      <emphasis role="bold">SSL_OP_CIPHER_SERVER_PREFERENCE</emphasis> and
      <emphasis role="bold">SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</emphasis>
      have been added in OpenSSL 0.9.7.
    </para>
    <para>
      <emphasis role="bold">SSL_OP_TLS_ROLLBACK_BUG</emphasis> has been
      added in OpenSSL 0.9.6 and was automatically enabled with <emphasis role="bold">SSL_OP_ALL</emphasis>. As of 0.9.7, it is no longer
      included in <emphasis role="bold">SSL_OP_ALL</emphasis> and must be
      explicitly set.
    </para>
    <para>
      <emphasis role="bold">SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</emphasis>
      has been added in OpenSSL 0.9.6e. Versions up to OpenSSL 0.9.6c do
      not include the countermeasure that can be disabled with this option
      (in OpenSSL 0.9.6d, it was always enabled).
    </para>
    <para>
      SSL_CTX_clear_options() and SSL_clear_options() were first added in
      OpenSSL 0.9.8m.
    </para>
    <para>
      <emphasis role="bold">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</emphasis>,
      <emphasis role="bold">SSL_OP_LEGACY_SERVER_CONNECT</emphasis> and the
      function SSL_get_secure_renegotiation_support() were first added in
      OpenSSL 0.9.8m.
    </para>
  </refsection>
</refentry>